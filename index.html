<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Платформер - Простой стиль</title>
    <style>
        body, html {margin:0; padding:0; height:100%; box-sizing:border-box;}
        body {background: #bada55; height:100vh; display:flex; align-items:center; justify-content:center;}
        #gameContainer { background:#fff; border:2px solid #444; border-radius:8px; padding:12px; box-sizing:border-box; max-width:500px; width:100%;}
        #gameArea { background:#87ceeb; border:2px solid #444; border-radius:8px; position:relative; width:100%; aspect-ratio:16/9; max-height:60vh; min-height:250px;}
        .player {position:absolute; background:#f66; border:2px solid #222;}
        .platform {position:absolute; background:#a52a2a; border:1px solid #333;}
        .enemy {position:absolute; background:#a3a; border:1px solid #333; border-radius:50%;}
        .collectible {position:absolute; background:#fc3; border:1px solid #333; border-radius:50%;}
        #ui {display:flex; justify-content:space-between; align-items:center; margin:8px 0; font-size:15px;}
        #controls { background:#eee; border-radius:6px; padding:7px; margin-top:10px;}
        .button-group {display:flex; gap:8px; justify-content:center;}
        .btn {font-size:14px; padding:8px 12px; border-radius:8px; border:1px solid #888; background:#ddd; cursor:pointer;}
        #touch-controls .btn { font-size:16px; min-width:40px; }
        #gameOverScreen { display:none; position:absolute; left:5%; top:10%; width:90%; background:#fff; border:2px solid #333; border-radius:8px; padding:20px; z-index:100;}
        .show {display:block;}
        h2 {margin-bottom:8px;}
    </style>
</head>
<body>
<div id="gameContainer">
    <div id="gameArea"><div class="player" id="player"></div></div>
    <div id="ui">
        <div>Очки: <span id="score">0</span></div>
        <div>Уровень: <span id="levelName">1</span></div>
    </div>
    <div id="controls">
        <div style="margin-bottom:4px;">Управление: ← → ↑ / ПРОБЕЛ или кнопки ниже</div>
        <div class="button-group">
            <button class="btn" onclick="startGame()">Старт</button>
            <button class="btn" onclick="pauseGame()">Пауза</button>
            <button class="btn" onclick="resetGame()">Сброс</button>
        </div>
        <div class="button-group" id="touch-controls" style="margin-top:8px;">
            <button class="btn" id="btnLeft">←</button>
            <button class="btn" id="btnJump">↑</button>
            <button class="btn" id="btnRight">→</button>
        </div>
    </div>
    <div id="gameOverScreen">
        <h2 id="gameOverTitle">Игра окончена!</h2>
        <p id="finalScore">Счет: 0</p>
        <p id="gameOverMessage"></p>
        <button class="btn" onclick="restartGame()">Новая игра</button>
    </div>
</div>
<script>
const GAME_WORLD_WIDTH = 900, GAME_WORLD_HEIGHT = 500;
let scaleX = 1, scaleY = 1;
const gameState = {
    running: false, paused: false, score: 0, level: 1,
    player: {element: document.getElementById('player'),x:0,y:0,width:0,height:0,velocityX:0,velocityY:0,onGround:false,speed:2,jumpForce:12},
    platforms: [], enemies: [], collectibles: [],
    keys: {}, gravity: 0.6,
    gameArea: document.getElementById('gameArea'),
    areaWidth: 0, areaHeight: 0, animationId: null
};
const levels = [
 {name:"Уровень 1",platforms:[{x:0,y:450,width:900,height:50},{x:200,y:350,width:150,height:20},{x:450,y:300,width:150,height:20},{x:700,y:250,width:150,height:20}],enemies:[{x:300,y:320,velocityX:2},{x:550,y:270,velocityX:-2}],collectibles:[{x:250,y:315},{x:500,y:265},{x:750,y:215},{x:400,y:400},{x:800,y:400}]},
 {name:"Уровень 2",platforms:[{x:0,y:450,width:900,height:50},{x:150,y:380,width:100,height:20},{x:350,y:320,width:100,height:20},{x:550,y:260,width:100,height:20},{x:750,y:200,width:100,height:20}],enemies:[{x:200,y:350,velocityX:2},{x:400,y:290,velocityX:-2},{x:600,y:230,velocityX:2},{x:600,y:410,velocityX:2}],collectibles:[{x:180,y:345},{x:380,y:285},{x:580,y:225},{x:780,y:165},{x:450,y:400},{x:700,y:400}]}
];
function scaleWorldX(x){return x*scaleX;}
function scaleWorldY(y){return y*scaleY;}
function scaleWorldW(w){return w*scaleX;}
function scaleWorldH(h){return h*scaleY;}
function init(){
    gameState.areaWidth = gameState.gameArea.offsetWidth; gameState.areaHeight = gameState.gameArea.offsetHeight;
    scaleX = gameState.areaWidth / GAME_WORLD_WIDTH; scaleY = gameState.areaHeight / GAME_WORLD_HEIGHT;
    loadLevel(0);
}
function loadLevel(levelIndex){
    const level = levels[levelIndex]; gameState.level = levelIndex+1;
    document.getElementById('levelName').textContent = level.name;
    gameState.platforms.forEach(p=>p.element.remove());
    gameState.enemies.forEach(e=>e.element.remove());
    gameState.collectibles.forEach(c=>c.element.remove());
    gameState.platforms=[]; gameState.enemies=[]; gameState.collectibles=[];
    level.platforms.forEach(p=>{
        const pf = document.createElement('div');
        pf.className='platform';
        pf.style.left = scaleWorldX(p.x)+'px';
        pf.style.top = scaleWorldY(p.y)+'px';
        pf.style.width = scaleWorldW(p.width)+'px';
        pf.style.height = scaleWorldH(p.height)+'px';
        gameState.gameArea.appendChild(pf);
        gameState.platforms.push({x:scaleWorldX(p.x),y:scaleWorldY(p.y),width:scaleWorldW(p.width),height:scaleWorldH(p.height),element:pf});
    });
    level.enemies.forEach(e=>{
        const em = document.createElement('div');
        em.className='enemy';
        em.style.left=scaleWorldX(e.x)+'px';
        em.style.top=scaleWorldY(e.y)+'px';
        em.style.width=scaleWorldW(35)+'px';
        em.style.height=scaleWorldH(35)+'px';
        gameState.gameArea.appendChild(em);
        gameState.enemies.push({x:scaleWorldX(e.x),y:scaleWorldY(e.y),width:scaleWorldW(35),height:scaleWorldH(35),velocityX:e.velocityX*scaleX,element:em});
    });
    level.collectibles.forEach(c=>{
        const col = document.createElement('div');
        col.className='collectible';
        col.style.left=scaleWorldX(c.x)+'px';
        col.style.top=scaleWorldY(c.y)+'px';
        col.style.width=scaleWorldW(20)+'px'; col.style.height=scaleWorldH(20)+'px';
        gameState.gameArea.appendChild(col);
        gameState.collectibles.push({x:scaleWorldX(c.x),y:scaleWorldY(c.y),width:scaleWorldW(20),height:scaleWorldH(20),element:col,collected:false});
    });
    gameState.player.x = scaleWorldX(50);
    gameState.player.y = gameState.platforms[0].y - scaleWorldH(45);
    gameState.player.width = scaleWorldW(35);
    gameState.player.height = scaleWorldH(45);
    gameState.player.velocityX = 0; gameState.player.velocityY = 0;
    gameState.player.onGround = false;
    updatePlayerPosition();
}
document.addEventListener('keydown',e=>{
    gameState.keys[e.key]=true;
    if((e.key==='ArrowUp'||e.key===' ')&&gameState.player.onGround){
        gameState.player.velocityY = -gameState.player.jumpForce*scaleY; gameState.player.onGround=false;
    }
});
document.addEventListener('keyup',e=>{gameState.keys[e.key]=false;});
function updatePlayerPosition(){
    const el=gameState.player.element;
    el.style.left=gameState.player.x+'px';
    el.style.top=gameState.player.y+'px';
    el.style.width=gameState.player.width+'px';
    el.style.height=gameState.player.height+'px';
}
function checkCollision(a,b){
    return a.x < b.x+b.width && a.x+a.width > b.x && a.y < b.y+b.height && a.y+a.height > b.y;
}
function gameLoop(){
    if(!gameState.running||gameState.paused)return;
    if(gameState.keys['ArrowLeft'])gameState.player.velocityX=-gameState.player.speed*scaleX;
    else if(gameState.keys['ArrowRight'])gameState.player.velocityX=gameState.player.speed*scaleX;
    else gameState.player.velocityX*=0.8;
    gameState.player.velocityY+=gameState.gravity*scaleY;
    gameState.player.x+=gameState.player.velocityX;
    gameState.player.y+=gameState.player.velocityY;
    gameState.player.onGround=false;
    gameState.platforms.forEach(p=>{
        if(checkCollision(gameState.player,p)){
            if(gameState.player.velocityY>0&&gameState.player.y<p.y){
                gameState.player.y=p.y-gameState.player.height;
                gameState.player.velocityY=0; gameState.player.onGround=true;
            }
        }
    });
    if(gameState.player.x<0)gameState.player.x=0;
    if(gameState.player.x+gameState.player.width>gameState.areaWidth)
        gameState.player.x=gameState.areaWidth-gameState.player.width;
    if(gameState.player.y>gameState.areaHeight){
        endGame(false,'Вы упали!');return;
    }
    gameState.enemies.forEach(em=>{
        em.x+=em.velocityX;
        if(em.x<=0||em.x+em.width>=gameState.areaWidth)em.velocityX*=-1;
        em.element.style.left=em.x+'px';
        if(checkCollision(gameState.player,em)){
            endGame(false,'Вас поймал враг!');return;
        }
    });
    let allCollected=true;
    gameState.collectibles.forEach(it=>{
        if(!it.collected){
            allCollected=false;
            if(checkCollision(gameState.player,it)){
                it.collected=true;it.element.style.display='none';
                gameState.score+=10;
                document.getElementById('score').textContent=gameState.score;
            }
        }
    });
    if(allCollected){
        if(gameState.level<levels.length){
            setTimeout(()=>{loadLevel(gameState.level);gameLoop();},500);return;
        }else{endGame(true,'Поздравляем! Все уровни пройдены!');return;}
    }
    updatePlayerPosition();
    gameState.animationId=requestAnimationFrame(gameLoop);
}
function startGame(){
    if(!gameState.running){
        gameState.running=true;gameState.paused=false;gameLoop();
    }
}
function pauseGame(){
    gameState.paused=!gameState.paused; if(!gameState.paused&&gameState.running)gameLoop();
}
function resetGame(){
    gameState.running=false;gameState.paused=false;gameState.score=0;
    document.getElementById('score').textContent='0';
    if(gameState.animationId)cancelAnimationFrame(gameState.animationId);
    loadLevel(0);
}
function restartGame(){
    document.getElementById('gameOverScreen').classList.remove('show');
    resetGame();startGame();
}
function endGame(won,msg){
    gameState.running=false;
    if(gameState.animationId)cancelAnimationFrame(gameState.animationId);
    document.getElementById('gameOverTitle').textContent=won?'Поздравляем!':'Игра окончена!';
    document.getElementById('finalScore').textContent=`Счет: ${gameState.score}`;
    document.getElementById('gameOverMessage').textContent=msg;
    document.getElementById('gameOverScreen').classList.add('show');
}
window.addEventListener('load',function(){
    init();
    const btnLeft=document.getElementById('btnLeft');
    const btnRight=document.getElementById('btnRight');
    const btnJump=document.getElementById('btnJump');
    function setKey(k,v){gameState.keys[k]=v;}
    if(btnLeft&&btnRight&&btnJump){
        btnLeft.addEventListener('touchstart',e=>{e.preventDefault();setKey('ArrowLeft',true);});
        btnLeft.addEventListener('touchend',e=>{e.preventDefault();setKey('ArrowLeft',false);});
        btnRight.addEventListener('touchstart',e=>{e.preventDefault();setKey('ArrowRight',true);});
        btnRight.addEventListener('touchend',e=>{e.preventDefault();setKey('ArrowRight',false);});
        btnJump.addEventListener('touchstart',e=>{
            e.preventDefault();
            if(gameState.player.onGround){
                gameState.player.velocityY=-gameState.player.jumpForce*scaleY;
                gameState.player.onGround=false;
            }
        });
    }
});
</script>
</body>
</html>
